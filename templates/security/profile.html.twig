{% extends 'base.html.twig' %}

{% block title %}Profile{% endblock %}

{% block body %}
<h1>Profile</h1>
<div>
    <h2>Modifier les informations personnelles</h2>
    <form action="/user/edit/me" method="POST">
        <div>
            <label for="nom">Nom:</label>
            <input type="text" id="nom" name="nom" value="{{ user.nom }}" required>
        </div>
        <div>
            <label for="prenom">Prenom:</label>
            <input type="text" id="prenom" name="prenom" value="{{ user.prenom }}" required>
        </div>
        <button type="submit">Sauvegarder les changements</button>
    </form>
</div>
<div>
    <h2>Changer l'email</h2>
    <form action="/update-my-email" method="POST">
        <div>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" value="{{ user.email }}" required>
        </div>
        <button type="submit">Sauvegarder les changements</button>
    </form>
</div>
<div>
    <h2>Changer le mot de passe</h2>
    <form action="/update-my-password" method="POST">
        <div>
            <label for="old_password">Ancien mot de passe:</label>
            <input type="password" id="old_password" name="old_password" required>
        </div>
        <div>
            <label for="new_password">Nouveau mot de passe:</label>
            <input type="password" id="new_password" name="new_password" required>
        </div>
        <div>
            <label for="confirm_password">Confirmez le nouveau mot de passe:</label>
            <input type="password" id="confirm_password" name="confirm_password" required>
        </div>
        {% if errors is defined and errors.password %}
            <p style="color: red">{{ errors.password }}</p>
        {% endif %}
        <button type="submit">Sauvegarder les changements</button>
    </form>
</div>
{% endblock %}

{% block javascripts %}
    <script>
        // Compare new password and confirmation password
        const newPasswordInput = document.getElementById("new_password");
        const confirmPasswordInput = document.getElementById("confirm_password");
        const submitButton = document.querySelector("button[type='submit']");
        const errorParagraph = document.querySelector("p");

        submitButton.disabled = true;

        function validatePassword() {
            if (newPasswordInput.value !== confirmPasswordInput.value) {
                errorParagraph.textContent = "Les deux mots de passe ne correspondent pas.";
                submitButton.disabled = true;
            } else {
                errorParagraph.textContent = "";
                submitButton.disabled = false;
            }
        }

        newPasswordInput.addEventListener("keyup", validatePassword);
        confirmPasswordInput.addEventListener("keyup", validatePassword);
    </script>
{% endblock %}
